<html>
<head>
	<meta charset="UTF-8">
	<script src="./echarts.min.js"></script>
	<script src="./jquery-3.2.1.min.js"></script>
</head>

<body style="width: 100%;height:100%;">
<div>

<div id="setting">
	<div style="float: left;">
        <input type="file" id="file" onchange="handleFiles(this.files)"/>
		<!-- <div style="float: left;">合约代码</div>
		<input type="text" id="contractcode" value="pb1707" style="float: left;"> -->
	</div>
	<div style="float: left;">
		<div style="float: left;">SD</div>
		<input style="float: left;" type="text" id="SD" value="2">
	</div>
	<div style="float: left;">
		<button type="button" onclick="startdraw()">draw</button>
	</div>
</div>
<br>
<br>
<br>
<br>

<div id="banddrawing" style="width: 3000px;height:500px;"></div>



<script type="text/javascript">

        filedata =''
        var band_myChart = echarts.init(document.getElementById('banddrawing'));

        // COMPXAVENUM = 10
        // 得到具体的标题数据，和对应的标题数据的具体的数。
        MIN=100000
        MAX=0

        
        // 用来保存线的具体的数据。是一个数组，就是echart的band_series_data
        // 用来保存时间的数组，以后就是图片的横坐标轴。
        times_array= []

        band_option = {
            toolbox: {
                show : true,
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar']},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            tooltip : {
                trigger: 'axis'
            },
            title: {
                text: 'bollinger band'
            },
            legend: {
                data:['lastprice',"minute_60","minute_5","minute_1"]
            },
            xAxis: {
                type: 'category',
                // data: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"]
            },
            yAxis: {
                min:MIN,
                max:MAX,
                type: 'value'
            },   
            series:[{
                name:"lastprice",
                type:"line",
                data:[]
            },{
                name:"minute_60",
                type:"line",
                data:[]
            },{
                name:"minute_5",
                type:"line",
                data:[]
            },{
                name:"minute_1",
                type:"line",
                data:[]
            }]      
        };



        // 根据input的file标签读取出相对应的csv的数据。
        // 首先有一个问题就是因为是针对一个合约的数据，所以不存在对其的问题，那么数据还需不需要补充。
        // 如果数据库中的数据，就是接受到的行情的本身的数据，那么就不需要补充，直接去除非交易时间的，直接用就可以了。
        // 补充的话，还会影响最后的效果。
        function  handleFiles(files)
        {
          if(files.length)
          {
             var file = files[0];
             var reader = new FileReader();
             reader.onload = function()
             {
                 // document.getElementById("filecontent").innerHTML = this.result;
                 // console.log(this.result)
                 var data = this.result
                 filedata = data.split("\n")
                 // console.log(file["name"].split("_"))
                band_option.title.text = file["name"].split("_")[0]
             };
             reader.readAsText(file);
          }
        }



        // 根据传入的参数进行画图，
        function startdraw(){
            // 首先确定一些基本的参数。确定要选择的几条线，然后和周期的评价指标，ema还是ma。

            for (var i = 0; i < filedata.length; i++) {
                var linedata = filedata[i].split(',')
                // 首先判断是不是已经达到我们所需要的周期了，如果还没有达到，那么就继续等着，不然就开始计算数据。
                var time = linedata[0]
                var lastprice = Number(linedata[1])
                var minute_60 = Number(linedata[2])
                var minute_5 = Number(linedata[3])
                var minute_1 = Number(linedata[4])
                


                if (lastprice==NaN) {
                    break
                }
                    
                times_array.push(time)

                if (MIN > lastprice) {
                    MIN = lastprice
                }
                if (MAX < lastprice) {
                    MAX = lastprice
                }

                band_option.series[0].data.push(lastprice)
                band_option.series[1].data.push(minute_60)
                band_option.series[2].data.push(minute_5)
                band_option.series[3].data.push(minute_1)

                if (MIN > lastprice) {
                    MIN = lastprice
                }
                if (MAX < lastprice) {
                    MAX = lastprice
                }
                if (MIN > minute_60) {
                    MIN = minute_60
                }
                if (MAX < minute_60) {
                    MAX = minute_60
                }
                if (MIN > minute_5) {
                    MIN = minute_5
                }
                if (MAX < minute_5) {
                    MAX = minute_5
                }
                if (MIN > minute_1) {
                    MIN = minute_1
                }
                if (MAX < minute_1) {
                    MAX = minute_1
                }

            }


            // console.log(band_legend_data)

            band_option.yAxis.min = MIN
            band_option.yAxis.max = MAX
            band_option.xAxis.data = times_array
            // console.log(option)

            band_myChart.setOption(band_option);


        }


        band_myChart.setOption(band_option);
        // ema_diff_volume_drawing.setOption(ema_diff_volume_option)
        // ema_diff_openinterest_drawing.setOption(ema_openinterest_option)

         // 使用刚指定的配置项和数据显示图表。
         
</script>

</div>

</body>
</html>
